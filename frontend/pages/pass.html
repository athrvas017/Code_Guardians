<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Password Security Toolkit | Code Guardians</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
  <header class="site-header">
    <div class="header-inner">
      <div class="logo">Code<span>Guardians</span></div>
      <nav class="nav">
        <a href="/" class="nav-link">Home</a>
        <a href="/password" class="nav-link active">Password Toolkit</a>
        <a href="/url-safety" class="nav-link">URL Safety</a>
        <a href="#" class="nav-link disabled">Extension</a>
      </nav>
    </div>
  </header>

  <main class="main">
    <div class="container">

      <div class="button-group">
        <button class="button active" data-target="generator">Password Generator</button>
        <button class="button" data-target="strength">Strength Checker</button>
        <button class="button" data-target="breach">Breach Detector</button>
      </div>

      <section class="content-section active" id="generator">
        <div class="card">
          <h2>Password Generator</h2>
          <form id="generator-form" class="form-grid">
            <div class="form-row">
              <label for="word-count">Number of words</label>
              <input id="word-count" type="number" min="4" max="16" value="4" required>
            </div>

            <div class="form-row">
              <label for="separator">Separator</label>
              <input id="separator" type="text" maxlength="3" value="-" placeholder="- _ .">
            </div>

            <button type="submit" class="button full-width">Generate</button>
          </form>

          <div class="password-output" id="generated-password" aria-live="polite"></div>
        </div>
      </section>

      <section class="content-section" id="strength">
        <div class="card">
          <h2>Password Strength Checker</h2>
          <form id="strength-form" class="form-grid">
            <div class="form-row">
              <label for="strength-password">Password</label>
              <input id="strength-password" type="password" placeholder="Enter or paste a password" required>
            </div>
            <button type="submit" class="button full-width">Analyze Strength</button>
          </form>

          <div class="strength-meter" aria-live="polite">
            <div class="strength-bar" id="strength-bar"></div>
          </div>
          <p class="strength-label" id="strength-label">Start typing to see password strength.</p>
          <ul class="strength-suggestions" id="strength-suggestions"></ul>
        </div>
      </section>

      <section class="content-section" id="breach">
        <div class="card">
          <h2>Password Breach Detector</h2>
          <p class="muted">Check if your password has been leaked in a data breach.</p>

          <form id="breach-form" class="form-grid">
            <div class="form-row">
              <label for="breach-password">Password</label>
              <input id="breach-password" type="password" placeholder="Enter password to check" required>
            </div>
            <button type="submit" id="breach-button" class="button full-width">Check Breach Status</button>
          </form>

          <div id="breach-result" class="breach-output"
            style="display: none; margin-top: 20px; padding: 15px; border-radius: 8px; text-align: center;">
            <div id="breach-emoji" style="font-size: 2rem; margin-bottom: 10px;"></div>
            <p id="breach-message" style="font-weight: bold; margin: 0;"></p>
          </div>
        </div>
      </section>

    </div>
  </main>

  <footer class="site-footer">
    <div class="footer-inner">
      <p>Cyber Threat Analysis Toolkit &bull; Code Guardians</p>
      <p class="footer-meta">Prototype UI â€“ API integrations and browser extension coming soon.</p>
    </div>
  </footer>

  <script type="module">
    // Import logic from Password.js
    import { generatePassword, evaluatePasswordStrength, checkPasswordBreach } from '/static/js/Password.js';

    // 1. Tab Navigation Logic
    const tabButtons = document.querySelectorAll('.button-group .button');
    const sections = document.querySelectorAll('.content-section');

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.dataset.target;

        // Toggle active sections
        sections.forEach(sec => {
          sec.classList.toggle('active', sec.id === target);
        });

        // Toggle active button state
        tabButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    // 2. Password Generator Logic
    const generatorForm = document.getElementById('generator-form');
    const generatedPasswordEl = document.getElementById('generated-password');

    generatorForm.addEventListener('submit', (event) => {
      event.preventDefault();

      const wordCount = parseInt(document.getElementById('word-count').value, 10) || 4;
      let separator = document.getElementById('separator').value || "-";

      try {
        const password = generatePassword({ wordCount, separator });
        generatedPasswordEl.textContent = password;
        generatedPasswordEl.classList.remove('error');
        generatedPasswordEl.classList.add('visible');
      } catch (error) {
        generatedPasswordEl.textContent = error.message;
        generatedPasswordEl.classList.add('visible', 'error');
      }
    });

    // 3. Password Strength Checker Logic
    const strengthInput = document.getElementById('strength-password');
    const strengthBar = document.getElementById('strength-bar');
    const strengthLabel = document.getElementById('strength-label');
    const strengthSuggestions = document.getElementById('strength-suggestions');

    function updateStrengthView() {
      const passwordValue = strengthInput.value;

      if (!passwordValue) {
        strengthBar.style.width = '0%';
        strengthLabel.textContent = "Start typing to see password strength.";
        strengthSuggestions.innerHTML = '';
        return;
      }

      const { score, label, suggestions } = evaluatePasswordStrength(passwordValue);

      // UI Updates
      const percentages = [0, 25, 50, 75, 100];
      strengthBar.style.width = percentages[score] + '%';

      // Applies CSS classes like strength-1, strength-2 for colors
      strengthBar.className = 'strength-bar strength-' + score;
      strengthLabel.textContent = label;

      // Update Suggestions
      strengthSuggestions.innerHTML = '';
      suggestions.forEach(text => {
        const li = document.createElement('li');
        li.textContent = text;
        strengthSuggestions.appendChild(li);
      });
    }

    strengthInput.addEventListener('input', updateStrengthView);
    //Passswword Breach Detector Logic
    // 4. Breach Detector Logic (Updated for your new object return)
    const breachForm = document.getElementById('breach-form');
    const breachInput = document.getElementById('breach-password');
    const breachButton = document.getElementById('breach-button');
    const breachResult = document.getElementById('breach-result');
    const breachEmoji = document.getElementById('breach-emoji');
    const breachMessage = document.getElementById('breach-message');

    breachForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      const password = breachInput.value;

      // UI Loading State
      breachButton.textContent = "Searching databases...";
      breachButton.disabled = true;
      breachResult.style.display = "none";

      try {
        const result = await checkPasswordBreach(password);

        // Show result container
        breachResult.style.display = "block";

        // Set text and emoji from your JS function
        breachEmoji.textContent = result.emoji || (result.status === "invalid" ? "ðŸ¤¨" : "");
        breachMessage.textContent = result.message;

        // Apply colors based on status
        const statusColors = {
          safe: "#d4edda",        // Green background
          exposed: "#fff3cd",     // Yellow
          danger: "#ffe5d0",      // Orange
          compromised: "#f8d7da", // Red
          invalid: "#e2e3e5"      // Gray
        };

        breachResult.style.backgroundColor = statusColors[result.status];
        breachResult.style.color = "#333";

      } catch (error) {
        console.error(error);
        alert("Could not connect to the breach database. Check your internet.");
      } finally {
        breachButton.textContent = "Check Breach Status";
        breachButton.disabled = false;
      }
    });

    // Prevent default form behavior for secondary forms
    document.getElementById('strength-form').addEventListener('submit', (e) => e.preventDefault());
    document.getElementById('breach-form').addEventListener('submit', (e) => e.preventDefault());
  </script>
</body>

</html>